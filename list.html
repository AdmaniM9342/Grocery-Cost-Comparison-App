<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Item Selector</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="landingstyle.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js"></script>
</head>
<body>
    <header>
        <h1>GrocerySaver</h1>
        <nav>
            <a href="index.html" id="clickable-heading" class="nav-link">Home</a>
            <a href="#" class="nav-link">Contact</a>
        </nav>
    </header>
    <h1>Select Items</h1>
    <form id="itemForm">
        <ul id="itemList">
            <!-- List of items will be dynamically added here -->
        </ul>
        <button type="button" onclick="showTotal()">Show Total</button>
    </form>
    <div id="priceListModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <div id="priceList"></div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const itemList = document.getElementById('itemList');

            // Load and process the Excel data
            fetch('Data.xlsx')
                .then(response => response.arrayBuffer())
                .then(arrayBuffer => {
                    const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                    const sheetName = workbook.SheetNames[0];
                    const sheet = workbook.Sheets[sheetName];
                    const data = XLSX.utils.sheet_to_json(sheet, { header: 1 });

                    const headers = data[0];
                    const itemData = data.slice(1);
                    const stores = headers.slice(1); // Store names

                    itemData.forEach((row, index) => {
                        const itemName = row[0];
                        const prices = row.slice(1);
                        const li = document.createElement('li');
                        li.innerHTML = `
                            <span>${itemName}</span>
                            <button type="button" onclick="changeQuantity(${index}, -1)">-</button>
                            <span id="quantity-${index}">0</span>
                            <button type="button" onclick="changeQuantity(${index}, 1)">+</button>
                            <input type="hidden" id="prices-${index}" value='${JSON.stringify(prices)}'>
                        `;
                        itemList.appendChild(li);
                    });
                });
        });

        function changeQuantity(index, delta) {
            const quantityElem = document.getElementById(`quantity-${index}`);
            let quantity = parseInt(quantityElem.textContent);
            if (isNaN(quantity)) {
                quantity = 0;
            }
            quantity = Math.max(0, quantity + delta); // Prevent negative quantity
            quantityElem.textContent = quantity;
        }

        function showTotal() {
            const stores = ['HEB', 'Walmart', 'Target', 'Randalls', 'Kroger', 'Fiesta'];
            let total = {};
            
            // Initialize totals for each store
            stores.forEach(store => total[store] = 0);

            stores.forEach((store, storeIndex) => {
                document.querySelectorAll('li').forEach((li, index) => {
                    const quantity = parseInt(document.getElementById(`quantity-${index}`).textContent);
                    const prices = JSON.parse(document.getElementById(`prices-${index}`).value);

                    total[store] += prices[storeIndex] * quantity;
                });
            });

            const cheapestStore = Object.keys(total).reduce((a, b) => total[a] < total[b] ? a : b);

            document.getElementById('priceList').innerHTML = `
                Total for HEB: $${total.HEB.toFixed(2)}<br>
                Total for Walmart: $${total.Walmart.toFixed(2)}<br>
                Total for Target: $${total.Target.toFixed(2)}<br>
                Total for Randalls: $${total.Randalls.toFixed(2)}<br>
                Total for Kroger: $${total.Kroger.toFixed(2)}<br>
                Total for Fiesta: $${total.Fiesta.toFixed(2)}<br>
                Cheapest store: ${cheapestStore}
            `;

            document.getElementById('priceListModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('priceListModal').style.display = 'none';
        }
    </script>
</body>
</html>
